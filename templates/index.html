<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <title>Dashboard & Payout Scheme</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;700&family=Lexend:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Anton&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <!-- Tab Navigation & Dark Mode Toggle -->
  <div class="top-navigation">
    <div id="topLeftDynamicContent" class="top-left-dynamic-content">
        <!-- JS will move controls here -->
    </div>
    <div class="tabs-and-toggle-container">
        <div class="tabs">
            <button id="homeTabBtn" class="tab-button active" onclick="showTab('homeArea', this)">Home</button>
            <button id="dashboardTabBtn" class="tab-button" onclick="showTab('dashboardDisplayArea', this)">Dashboard</button>
            <button id="salaryTabBtn" class="tab-button" onclick="showTab('salarySchemeArea', this)">Salary Scheme</button>
            <button id="adminTabBtn" class="tab-button" onclick="showTab('adminArea', this)" style="display: none;">Admin</button>
            <button id="payoutTabBtn" class="tab-button" onclick="showTab('payoutArea', this)">Payout</button>
        </div>
        <div id="userInfo" class="user-info" style="display: none;">
            <span id="userName" class="user-name"></span>
            <a href="/logout" class="logout-button" title="Sign Out">üö™</a>
        </div>
        <button id="darkModeToggle" title="Toggle Dark/Light Mode">‚òÄÔ∏è</button>
    </div>
  </div>

  <div class="app-container">
    <div id="mainContentWrapper">
        <!-- HOME TAB CONTENT -->
        <div id="homeArea" class="tab-content active-content">
            <div id="homeContentCentered" class="home-content-centered">
                <div id="homeTitleContainer" class="home-title-container">
                    <h1 class="home-main-title">DASHBOARD</h1>
                    <span class="home-subtitle">By Love</span>
                </div>
                <div id="homeSearchControlsContainer" class="home-search-controls-container">
                    <div class="home-search-controls">
                        <select id="monthSelect">
                            <option value="" disabled selected>SELECT MONTH</option>
                            <option value="January">January</option><option value="February">February</option><option value="March">March</option><option value="April">April</option><option value="May">May</option><option value="June">June</option><option value="July">July</option><option value="August">August</option><option value="September">September</option><option value="October">October</option><option value="November">November</option><option value="December">December</option>
                        </select>
                        <select id="weekSelect">
                            <option value="" disabled selected>SELECT WEEK</option>
                            <option value="Week 1">Week 1</option>
                            <option value="Week 2">Week 2</option>
                            <option value="Week 3">Week 3</option>
                            <option value="Week 4">Week 4</option>
                            <option id="week5Option" value="Week 5">Week 5</option>
                        </select>
                        
                        <!-- *** FIX: Added container for all BA name inputs *** -->
                        <div class="ba-name-input-container">
                            <!-- Input for regular users -->
                            <input type="text" id="baNameInput" placeholder="ENTER BA NAME" autocomplete="on" list="baNameSuggestions" style="display: none;">
                            <datalist id="baNameSuggestions"></datalist>

                            <!-- Container for multi-select dropdown for special users -->
                            <div id="baNameSelectContainer" style="display: none;">
                                <button id="baNameSelectButton" type="button">SELECT BA NAME</button>
                                <div id="baNameDropdown" class="ba-dropdown">
                                    <input type="text" id="baNameSearchInput" placeholder="Search names...">
                                    <div id="baNameCheckboxList"></div>
                                </div>
                            </div>
                        </div>

                        <input type="text" id="palcodeInput" placeholder="ENTER PALCODE (OPTIONAL)">
                        <button id="searchButton" class="search-button">SEARCH</button>
                    </div>
                    <div id="homeErrorMessage" class="error-message-main"></div>
                </div>
            </div>
        </div>

        <!-- DASHBOARD TAB CONTENT -->
        <div id="dashboardDisplayArea" class="tab-content">
            <div id="dashboardPlaceholder" class="dashboard-placeholder-message">
                <p> üîé Please perform a search to view dashboard data.</p>
            </div>
            <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                ‚è≥ Fetching dashboard data, please wait...
            </div>
            <div id="dashboardSearchError" class="dashboard-placeholder-message" style="display: none; color: orange;">
                <p>‚ö†Ô∏è No data found for the selected criteria, or the search parameters were insufficient.</p>
            </div>
            <div id="dashboardDataDisplay" class="dashboard-content-area" style="display: none;">
              <div class="left-panel">
                <div id="baNameDisplay" class="ba-name-display"></div>
                <div class="summary-section"><h4>SUMMARY</h4></div>
                <div class="summary-cards-container">
                  <div class="summary-card"><span class="summary-label">TOTAL REG</span><span class="summary-value" id="totalRegistrationValue">0</span></div>
                  <div class="summary-card"><span class="summary-label">TOTAL VALID FD</span><span class="summary-value" id="totalValidFdValue">0</span></div>
                  <div class="summary-card"><span class="summary-label">TOTAL SUSPENDED</span><span class="summary-value" id="totalSuspendedValue">0</span></div>
                  <div class="summary-card"><span class="summary-label">TOTAL SALARY</span><span class="summary-value" id="totalSalaryValue">0</span></div>
                  <div class="summary-card"><span class="summary-label">INCENTIVES</span><span class="summary-value" id="totalIncentiveValue">‚Ç±0.00</span></div>
                  <div id="commissionCard" class="summary-card" style="display: none;">
                    <span class="summary-label">COMMISSION</span>
                    <span class="summary-value" id="totalCommissionValue">0</span>
                  </div>
                </div>
                <div class="filter-display">
                    <span id="monthDisplay">MONTH</span>
                    <span id="weekDisplay">WEEK</span>
                </div>
                <div id="dateRangeDisplay" class="date-range-display"></div>
                <div class="status-display">STATUS: <span id="statusValue">N/A</span></div>
                <div class="ba-ranking-section">
                    <h4>TOP BA RANKING (VALID FD)</h4>
                    <div id="baRankingList" class="ba-ranking-list"></div>
                </div>
              </div>
              <div class="right-panel">
                <div id="tableControls" class="table-controls" style="display: none;">
                    <button id="saveButton" class="save-button">Save Changes</button>
                    <span id="saveStatusMessage"></span>
                </div>
                <div id="resultsTableContainer" class="results-table-container"></div>
                <div class="last-update-display">LAST UPDATE: <span id="lastUpdateValue">N/A</span></div>
              </div>
            </div>
        </div>

        <!-- SALARY SCHEME TAB CONTENT -->
        <div id="salarySchemeArea" class="tab-content">
            <h1 class="ba-payout-header">BA PAYOUT SCHEME</h1>
            <div class="salary-scheme-table-container">
                <table>
                    <thead><tr><th>GGR per FD</th><th>Standard FD Rate</th><th>Weekly FD</th><th>Total Payout</th></tr></thead>
                    <tbody>
                         <tr><td>BELOW ‚Ç±99</td><td>‚Ç± 25.00</td><td>100</td><td>‚Ç± 2,500.00</td></tr>
                         <tr><td>‚Ç±100 - ‚Ç±149</td><td>‚Ç± 60.00</td><td>100</td><td>‚Ç± 6,000.00</td></tr>
                         <tr><td>‚Ç±150 - ‚Ç±499</td><td>‚Ç± 90.00</td><td>100</td><td>‚Ç± 9,000.00</td></tr>
                         <tr><td>‚Ç±500 - ‚Ç±999</td><td>‚Ç± 140.00</td><td>100</td><td>‚Ç± 14,000.00</td></tr>
                         <tr><td>‚Ç±1,000 - ‚Ç±1,499</td><td>‚Ç± 230.00</td><td>100</td><td>‚Ç± 23,000.00</td></tr>
                         <tr><td>‚Ç±1,500 - ‚Ç±1,999</td><td>‚Ç± 325.00</td><td>100</td><td>‚Ç± 32,500.00</td></tr>
                         <tr><td>‚Ç±2,000 AND ABOVE</td><td>‚Ç± 420.00</td><td>100</td><td>‚Ç± 42,000.00</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="salary-notes">
                <h3>NOTES:</h3>
                <ul>
                     <li><strong>GGR Cutoff:</strong> Monday to Sunday (Weekly)</li>
                     <li>The current day GGR file will be sent the next day, but the final GGR for the whole payout week will come from the data team after their verification, as this might still increase the GGR of each parent code.</li>
                     <li>The payout scheme is subject to change at the sole discretion of the company in the event that any abusive acts executed by the brand ambassadors are identified.</li>
                     <li><strong>0 Reg = 0 FD</strong></li>
                     <li>FDs with an amount below 100 pesos are disqualified.</li><li> Suspended accounts wil be deducted from weekly payout to ensure that no FAKE accounts were paid to BAs</li>
                </ul>
            </div>
        </div>

        <!-- ADMIN AREA CONTENT -->
        <div id="adminArea" class="tab-content">
            <div class="admin-panel-container">
                <h1>User Management</h1>
                <p>Grant or revoke specific permissions for users. Root Admins have all permissions by default and their roles cannot be changed here.</p>
                <div id="adminStatusMessage" class="admin-status-message"></div>
                <div id="userManagementTableContainer">
                    <div class="loading-indicator">‚è≥ Loading users...</div>
                </div>
            </div>
        </div>

        <!-- PAYOUT FORM TAB CONTENT -->
        <div id="payoutArea" class="tab-content">
          <div class="payout-form-container">
            <h2>Payout Submission</h2>
            <p>Please provide your payment details and upload a QR code image.</p>
             <div class="upload-warnings">Add commentMore actions
                    <h4>Important Reminders:</h4>
                    <ul>
                        <li>Ensure the Account limit is enough for your salary.</li>
                        <li>Ensure the Account Name and Number are **exactly correct**.</li>
                        <li>The uploaded image **must be a clear QR code**.</li>
                        <li>File size limit is **5MB**.</li>
                        <li>Allowed format is **JPEG/JPG or PNG**.</li>
                        <li>Any new upload will **overwrite** your previous submission.</li>
                    </ul>
                </div>
            <form id="payoutForm" enctype="multipart/form-data">
              <label>BA NAME:<br><input type="text" name="ba_name" required></label><br>
              <label>MOP ACCOUNT NAME:<br><input type="text" name="mop_account_name" required></label><br>
              <label>MOP NUMBER:<br><input type="text" name="mop_number" required></label><br>
              <label>Upload QR Image:<br><input type="file" name="qr_image" accept="image/*" required></label><br>
              <button type="submit">Submit</button>
              <span id="payoutFormStatus"></span>
            </form>
          </div>
          <div id="payoutListContainer">
              <h2 id="payoutListTitle" style="display:none; text-align:center; margin-top:2em;">All Payout Submissions</h2>
              <div id="payoutInfoCards"></div>
          </div>
        </div>

    </div>
  </div>
  <div id="globalErrorMessage" class="error-message-main" style="padding: 10px; text-align: center; display:none;"></div>

  <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>